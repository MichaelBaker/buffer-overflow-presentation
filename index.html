<!DOCTYPE html>
<html>
  <head>
    <title>Presentation</title>

    <meta charset='utf-8'>
    <script src='slides.js'></script>
    <script src='jquery.js'></script>
    <script type="text/javascript" charset="utf-8">
      var createProgram = function(initialValues) {
        // Required Values
        var memory                    = initialValues["memory"]
        var input                     = initialValues["input"]
        var instructionPointerDisplay = initialValues["instructionPointer"]
        var output                    = initialValues["output"]

        // Optional Values
        var startInstruction  = initialValues["startInstruction"]  || 0
        var startStackPointer = initialValues["stackPointer"] || -1

        var instructionPointer = startInstruction
        var stackPointer       = startStackPointer
        var currentInput       = 0

        var instructions = {};
        var program      = {};

        var clearHighlights = function() {
          memory.removeClass("highlight")
          memory.removeClass("secondary-highlight")
          input.removeClass("highlight")
          input.removeClass("secondary-highlight")
        }

        var highlight = function() {
          $(memory[instructionPointer]).addClass("highlight");
          $(input[currentInput]).addClass("secondary-highlight")
        }

        var updateIP = function(address) {
          address = parseInt(address, 10)
          instructionPointer = address
          instructionPointerDisplay.html(address)
        }

        var pushValue = function(value) {
          stackPointer += 1
          $(memory[stackPointer]).html(value)
        }

        var getInstructionToken = function(offset) {
          offset = offset || 0
          return $(memory[instructionPointer + offset]).html()
        }

        var performInstruction = function(instruction) {
          if(instructions[instruction] == null){
            program.reset()
          } else {
            instructions[instruction].perform()
          }
        }

        var secondaryHighlightByte = function(address) {
          $(memory[address]).addClass("secondary-highlight")
        }

        var clearStack = function() {
          for(var i = startStackPointer; i <= stackPointer; i++) {
            $(memory[i]).html("")
          }
        }

        var getInstruction = function(offset) {
          return instructions[getInstructionToken(offset)]
        }

        var popByte = function() {
          var value = $(memory[stackPointer]).html()
          $(memory[stackPointer]).html("")
          stackPointer -= 1
          return value;
        }

        instructions.R = {
          perform: function() {
            var inputValue = $(input[currentInput]).html()
            pushValue(inputValue)
            currentInput += 1
            secondaryHighlightByte(stackPointer)
            updateIP(instructionPointer + this.size)
          },
          size: 1
        }

        instructions.G = {
          perform: function() {
            var inputValue = $(memory[instructionPointer + 1]).html()
            updateIP(inputValue)
          },
          size: 2
        }

        instructions.P = {
          perform: function() {
            outputValue = $(memory[instructionPointer + 1]).html()
            output.append($("<span>").html(outputValue))
            updateIP(instructionPointer + this.size)
          },
          size: 2
        }

        instructions.S = {
          perform: function() {
            var instructionSize = getInstruction(1).size
            pushValue(instructionPointer + instructionSize + this.size)
            updateIP(instructionPointer + this.size)
          },
          size: 1
        }

        instructions.F = {
          perform: function() {
            var address = parseInt(popByte(), 10);
            updateIP(address)
          },
          size: 1
        }

        program.instruction

        program.step = function() {
          clearHighlights();
          highlight();
          performInstruction(getInstructionToken())
        }

        program.reset = function() {
          clearHighlights()
          clearStack()
          updateIP(startInstruction)
          stackPointer = startStackPointer
          currentInput = 0
          output.html("")
        }

        return program;
      }
    </script>
  </head>

  <style>
    /* Your individual styles here, or just use inline styles if thatâ€™s
       what you want. */
    article {
      background: white !important;
    }

    .memory, .memory td {
      width:  300px;
    }

    .memory td {
      border: 2px solid black;
      height: 35px;
      min-width: 35px;
      text-align: center;
    }

    td.address {
      border: white;
    }

    .highlight {
      color: red;
    }

    .secondary-highlight {
      color: blue;
    }
  </style>

  <body style='display: none'>
    <section class='slides layout-regular template-default'>
      <article>
        <h1>
          The Classic
          <br>
          Buffer Overflow
        </h1>
        <p>
          Michael Baker
          <br>
          May 4, 2012
        </p>
      </article>

      <article>
        <img style="display: block; margin: auto" src="images/memory-model.png">
      </article>

      <article>
        <table class="memory" style="display: block; margin: auto">
          <tr> <td class="address">IP</td><td colspan=4></td></tr>
          <tr> <td class="address">0</td> <td class="highlight">A</td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">4</td> <td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">8</td> <td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">12</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">16</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">20</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">24</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">28</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">32</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">36</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">40</td><td></td> <td></td> <td></td> <td></td> </tr>
        </table>
      </article>

      <article>
        <table class="memory" style="display: block; margin: auto">
          <tr> <td class="address">IP</td><td colspan=4></td></tr>
          <tr> <td class="address">0</td> <td class="highlight">65</td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">4</td> <td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">8</td> <td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">12</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">16</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">20</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">24</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">28</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">32</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">36</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">40</td><td></td> <td></td> <td></td> <td></td> </tr>
        </table>
      </article>

      <article>
        <table class="memory" style="display: block; margin: auto">
          <tr> <td class="address">IP</td><td colspan=4>0</td></tr>
          <tr> <td class="address">0</td> <td class="highlight">i4</td> <td>i5</td> <td></td> <td></td> </tr>
          <tr> <td class="address">4</td> <td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">8</td> <td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">12</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">16</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">20</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">24</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">28</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">32</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">36</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">40</td><td></td> <td></td> <td></td> <td></td> </tr>
        </table>
      </article>

      <article>
        <table class="memory" style="display: block; margin: auto">
          <tr> <td class="address">IP</td><td colspan=4>1</td></tr>
          <tr> <td class="address">0</td> <td>i4</td> <td class="highlight">i5</td> <td></td> <td></td> </tr>
          <tr> <td class="address">4</td> <td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">8</td> <td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">12</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">16</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">20</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">24</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">28</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">32</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">36</td><td></td> <td></td> <td></td> <td></td> </tr>
          <tr> <td class="address">40</td><td></td> <td></td> <td></td> <td></td> </tr>
        </table>
      </article>

      <article>
        <table id="trolol-program-table" class="memory" style="float:left">
          <tr> <td class="address">IP</td><td class="ip" colspan=4></td></tr>
          <tr> <td class="address">0</td>
            <td data-address=0></td>
            <td data-address=1></td>
            <td data-address=2></td>
            <td data-address=3></td></tr>
          <tr> <td class="address">4</td>
            <td data-address=4></td>
            <td data-address=5></td>
            <td data-address=6></td>
            <td data-address=7></td></tr>
          <tr> <td class="address">8</td>
            <td data-address=8></td>
            <td data-address=9></td>
            <td data-address=10></td>
            <td data-address=11></td></tr>
          <tr> <td class="address">12</td>
            <td data-address=12></td>
            <td data-address=13></td>
            <td data-address=14></td>
            <td data-address=15></td></tr>
          <tr> <td class="address">16</td>
            <td data-address=16></td>
            <td data-address=17></td>
            <td data-address=18></td>
            <td data-address=19></td></tr>
          <tr> <td class="address">20</td>
            <td data-address=20></td>
            <td data-address=21></td>
            <td data-address=22></td>
            <td data-address=23></td></tr>
          <tr> <td class="address">24</td>
            <td data-address=24></td>
            <td data-address=25></td>
            <td data-address=26></td>
            <td data-address=27></td></tr>
          <tr> <td class="address">28</td>
            <td data-address=28></td>
            <td data-address=29></td>
            <td data-address=30></td>
            <td data-address=31></td></tr>
          <tr> <td class="address">32</td>
            <td data-address=32>R</td>
            <td data-address=33>R</td>
            <td data-address=34>R</td>
            <td data-address=35>R</td></tr>
          <tr> <td class="address">36</td>
            <td data-address=36>R</td>
            <td data-address=37>R</td>
            <td data-address=38>R</td>
            <td data-address=39>R</td></tr>
          <tr> <td class="address">40</td>
            <td data-address=40>R</td>
            <td data-address=41>R</td>
            <td data-address=42>G</td>
            <td data-address=43>0</td> </tr>
        </table>
        <div style="position: absolute; right: 50px; top: 80px; width: 400px">
          <p>R: Read a byte of user input into memory</p>
          <p>G: Go to the address given by the next byte</p>
          <p>P: Print the next byte to the output</p>
          <p id="trolol-program-input">
            User Input: <br>
            <span data-input=0>P</span>
            <span data-input=1>T</span>
            <span data-input=2>P</span>
            <span data-input=3>R</span>
            <span data-input=4>P</span>
            <span data-input=5>O</span>
            <span data-input=6>P</span>
            <span data-input=7>L</span>
            <span data-input=8>G</span>
            <span data-input=9>2</span>
          </p>
          <p>
            Output:
            <p id="trolol-program-output"></p>
          </p>
        </div>
        <div>
          <input onclick="trololProgram.step()" type="button" name="trolol-program-step" value="Step" style="position: absolute; top: 50px; left: 190px">
          <input onclick="trololProgram.reset()" type="button" name="trolol-program-reset" value="Reset" style="position: absolute; top: 50px; left: 250px">
        </div>

        <script type="text/javascript" charset="utf-8">
          var trololProgram = createProgram({
              startInstruction: 32,
              memory: $("#trolol-program-table [data-address]"),
              input:  $("#trolol-program-input [data-input]"),
              output: $("#trolol-program-output"),
              instructionPointer: $("#trolol-program-table .ip")})
        </script>
      </article>

      <article>
        <table id="notdry-program-table" class="memory" style="float:left">
          <tr> <td class="address">IP</td><td class="ip" colspan=4></td></tr>
          <tr> <td class="address">0</td>
            <td data-address=0></td>
            <td data-address=1></td>
            <td data-address=2></td>
            <td data-address=3></td></tr>
          <tr> <td class="address">4</td>
            <td data-address=4></td>
            <td data-address=5></td>
            <td data-address=6></td>
            <td data-address=7></td></tr>
          <tr> <td class="address">8</td>
            <td data-address=8></td>
            <td data-address=9></td>
            <td data-address=10></td>
            <td data-address=11></td></tr>
          <tr> <td class="address">12</td>
            <td data-address=12></td>
            <td data-address=13></td>
            <td data-address=14></td>
            <td data-address=15></td></tr>
          <tr> <td class="address">16</td>
            <td data-address=16></td>
            <td data-address=17></td>
            <td data-address=18></td>
            <td data-address=19></td></tr>
          <tr> <td class="address">20</td>
            <td data-address=20></td>
            <td data-address=21></td>
            <td data-address=22></td>
            <td data-address=23></td></tr>
          <tr> <td class="address">24</td>
            <td data-address=24>R</td>
            <td data-address=25>P</td>
            <td data-address=26>O</td>
            <td data-address=27>P</td></tr>
          <tr> <td class="address">28</td>
            <td data-address=28>K</td>
            <td data-address=29>R</td>
            <td data-address=30>P</td>
            <td data-address=31>O</td></tr>
          <tr> <td class="address">32</td>
            <td data-address=32>P</td>
            <td data-address=33>K</td>
            <td data-address=34>R</td>
            <td data-address=35>P</td></tr>
          <tr> <td class="address">36</td>
            <td data-address=36>O</td>
            <td data-address=37>P</td>
            <td data-address=38>K</td>
            <td data-address=39>R</td></tr>
          <tr> <td class="address">40</td>
            <td data-address=40>P</td>
            <td data-address=41>O</td>
            <td data-address=42>P</td>
            <td data-address=43>K</td> </tr>
        </table>
        <div style="position: absolute; right: 50px; top: 80px; width: 400px">
          <p id="notdry-program-input">
            User Input: <br>
            <span data-input=0>H</span>
            <span data-input=1>E</span>
            <span data-input=1>L</span>
            <span data-input=1>O</span>
          </p>
          <p>
            Output:
            <p id="notdry-program-output"></p>
          </p>
        </div>
        <div>
          <input onclick="notDryProgram.step()" type="button" name="first-program-step" value="Step" style="position: absolute; top: 50px; left: 190px">
          <input onclick="notDryProgram.reset()" type="button" name="first-program-reset" value="Reset" style="position: absolute; top: 50px; left: 250px">
        </div>

        <script type="text/javascript" charset="utf-8">
          var notDryProgram = createProgram({
              startInstruction: 24,
              memory: $("#notdry-program-table [data-address]"),
              input: $("#notdry-program-input [data-input]"),
              output: $("#notdry-program-output"),
              instructionPointer: $("#notdry-program-table .ip")})
        </script>
      </article>

      <article>
        <table id="reusebad-program-table" class="memory" style="float:left">
          <tr> <td class="address">IP</td><td class="ip" colspan=4></td></tr>
          <tr> <td class="address">0</td>
            <td data-address=0></td>
            <td data-address=1></td>
            <td data-address=2></td>
            <td data-address=3></td></tr>
          <tr> <td class="address">4</td>
            <td data-address=4></td>
            <td data-address=5></td>
            <td data-address=6></td>
            <td data-address=7></td></tr>
          <tr> <td class="address">8</td>
            <td data-address=8></td>
            <td data-address=9></td>
            <td data-address=10></td>
            <td data-address=11></td></tr>
          <tr> <td class="address">12</td>
            <td data-address=12></td>
            <td data-address=13></td>
            <td data-address=14></td>
            <td data-address=15></td></tr>
          <tr> <td class="address">16</td>
            <td data-address=16>P</td>
            <td data-address=17>O</td>
            <td data-address=18>P</td>
            <td data-address=19>K</td></tr>
          <tr> <td class="address">20</td>
            <td data-address=20></td>
            <td data-address=21></td>
            <td data-address=22></td>
            <td data-address=23></td></tr>
          <tr> <td class="address">24</td>
            <td data-address=24>R</td>
            <td data-address=25>G</td>
            <td data-address=26>16</td>
            <td data-address=27>R</td></tr>
          <tr> <td class="address">28</td>
            <td data-address=28>G</td>
            <td data-address=29>16</td>
            <td data-address=30>R</td>
            <td data-address=31>G</td></tr>
          <tr> <td class="address">32</td>
            <td data-address=32>16</td>
            <td data-address=33>R</td>
            <td data-address=34>G</td>
            <td data-address=35>16</td></tr>
          <tr> <td class="address">36</td>
            <td data-address=36></td>
            <td data-address=37></td>
            <td data-address=38></td>
            <td data-address=39></td></tr>
          <tr> <td class="address">40</td>
            <td data-address=40></td>
            <td data-address=41></td>
            <td data-address=42></td>
            <td data-address=43></td> </tr>
        </table>
        <div style="position: absolute; right: 50px; top: 80px; width: 400px">
          <p id="reusebad-program-input">
            User Input: <br>
            <span data-input=0>H</span>
            <span data-input=1>E</span>
            <span data-input=1>L</span>
            <span data-input=1>O</span>
          </p>
          <p>
            Output:
            <p id="reusebad-program-output"></p>
          </p>
        </div>
        <div>
          <input onclick="reuseBadProgram.step()" type="button" name="first-program-step" value="Step" style="position: absolute; top: 50px; left: 190px">
          <input onclick="reuseBadProgram.reset()" type="button" name="first-program-reset" value="Reset" style="position: absolute; top: 50px; left: 250px">
        </div>

        <script type="text/javascript" charset="utf-8">
          var reuseBadProgram = createProgram({
              startInstruction: 24,
              memory: $("#reusebad-program-table [data-address]"),
              input: $("#reusebad-program-input [data-input]"),
              output: $("#reusebad-program-output"),
              instructionPointer: $("#reusebad-program-table .ip")})
        </script>
      </article>

      <article>
        <table id="reuse-program-table" class="memory" style="float:left">
          <tr> <td class="address">IP</td><td class="ip" colspan=4></td></tr>
          <tr> <td class="address">0</td>
            <td data-address=0></td>
            <td data-address=1></td>
            <td data-address=2></td>
            <td data-address=3></td></tr>
          <tr> <td class="address">4</td>
            <td data-address=4></td>
            <td data-address=5></td>
            <td data-address=6></td>
            <td data-address=7></td></tr>
          <tr> <td class="address">8</td>
            <td data-address=8></td>
            <td data-address=9></td>
            <td data-address=10></td>
            <td data-address=11></td></tr>
          <tr> <td class="address">12</td>
            <td data-address=12></td>
            <td data-address=13></td>
            <td data-address=14></td>
            <td data-address=15></td></tr>
          <tr> <td class="address">16</td>
            <td data-address=16>P</td>
            <td data-address=17>O</td>
            <td data-address=18>P</td>
            <td data-address=19>K</td></tr>
          <tr> <td class="address">20</td>
            <td data-address=20>F</td>
            <td data-address=21></td>
            <td data-address=22></td>
            <td data-address=23></td></tr>
          <tr> <td class="address">24</td>
            <td data-address=24></td>
            <td data-address=25></td>
            <td data-address=26></td>
            <td data-address=27></td></tr>
          <tr> <td class="address">28</td>
            <td data-address=28>R</td>
            <td data-address=29>S</td>
            <td data-address=30>G</td>
            <td data-address=31>16</td></tr>
          <tr> <td class="address">32</td>
            <td data-address=32>R</td>
            <td data-address=33>S</td>
            <td data-address=34>G</td>
            <td data-address=35>16</td></tr>
          <tr> <td class="address">36</td>
            <td data-address=36>R</td>
            <td data-address=37>S</td>
            <td data-address=38>G</td>
            <td data-address=39>16</td></tr>
          <tr> <td class="address">40</td>
            <td data-address=40>R</td>
            <td data-address=41>S</td>
            <td data-address=42>G</td>
            <td data-address=43>16</td> </tr>
        </table>
        <div style="position: absolute; right: 50px; top: 80px; width: 400px">
          <p>S: Save the next address instruction onto the stack</p>
          <p>F: Fetch the thing on the top of the stack and put it in the instruction pointer</p>
          <p id="reuse-program-input">
            User Input: <br>
            <span data-input=0>H</span>
            <span data-input=1>E</span>
            <span data-input=1>L</span>
            <span data-input=1>O</span>
          </p>
          <p>
            Output:
            <p id="reuse-program-output"></p>
          </p>
        </div>
        <div>
          <input onclick="reuseProgram.step()" type="button" name="first-program-step" value="Step" style="position: absolute; top: 50px; left: 190px">
          <input onclick="reuseProgram.reset()" type="button" name="first-program-reset" value="Reset" style="position: absolute; top: 50px; left: 250px">
        </div>

        <script type="text/javascript" charset="utf-8">
          var reuseProgram = createProgram({
              startInstruction: 28,
              memory: $("#reuse-program-table [data-address]"),
              input: $("#reuse-program-input [data-input]"),
              output: $("#reuse-program-output"),
              instructionPointer: $("#reuse-program-table .ip")})
        </script>
      </article>
    </section>
  </body>
</html>
